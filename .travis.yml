language: c
git:
  submodules: false

env: B=autotools

os: linux

cache:
  apt: true

sudo: required

services:
  - docker

install:
  - docker version
  - ./dbld/rules image
before_script:
  - CONFIGURE_OPTS="
      CFLAGS=-Werror
      --prefix=$HOME/install/syslog-ng
      --with-ivykis=internal
      --with-mongoc=internal
      --with-librabbitmq=internal
      --with-jsonc=system
      --disable-env-wrapper
      --disable-memtrace
      --enable-tcp-wrapper
      --enable-linux-caps
      --disable-sun-streams
      --enable-all-modules
      --disable-sql
      --enable-pacct
      --enable-manpages
      --with-python=2
      --with-docbook=/usr/share/xml/docbook/stylesheet/docbook-xsl/manpages/docbook.xsl
      --enable-extra-warnings
      "
  - if [ "$CC" = "clang" ]; then
      CONFIGURE_OPTS="$CONFIGURE_OPTS --disable-mongodb" ;
    fi
  - ./dbld/rules bootstrap CONFIGURE_OPTS="$CONFIGURE_OPTS"
script:
  - ./dbld/rules make-check MAKE_ARGS=-j4
compiler:
  - gcc
  - clang

branches:
  except:
    - /wip/
notifications:
  irc:
    channels:
      - "irc.freenode.org#balabit"
  webhooks:
      urls:
        - https://webhooks.gitter.im/e/1c6e3a6f10348748585a
      on_success: always  # options: [always|never|change] default: always
      on_failure: always  # options: [always|never|change] default: always
      on_start: true     # default: false
